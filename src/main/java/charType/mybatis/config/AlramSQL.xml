<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="alram">


<select id="alramCheck" resultType="hashmap" parameterType="hashmap">
SELECT
	ALRAM_NUM,
	ALRAM_INDEX_NO,
	ALRAM_ID,
	ALRAM_CONTNUM,
	REG_ID,
	REGDATE,
	READDATE
FROM 
	TB_ALRAM
WHERE 
	ALRAM_INDEX_NO = #{ALRAM_INDEX_NO} and ALRAM_CONTNUM = #{ALRAM_CONTNUM} and ALRAM_ID = #{ALRAM_ID}
	and REG_ID = #{REG_ID} and READDATE is null </select>


<select id="alramLoad" resultType="java.util.HashMap" parameterType="java.util.HashMap">
SELECT
	ALRAM_NUM,
	ALRAM_INDEX_NO,
	ALRAM_ID,
	ALRAM_CONTNUM,
	REG_ID,
	REGDATE,
	READDATE,
	U.PROF_IMG,
    B.BOARD_NUM,
    B.TITLE
FROM 
	TB_ALRAM, TB_USER U, TB_BOARD B
WHERE
	 ALRAM_ID = #{ALRAM_ID} 
     AND READDATE is null 
     AND U.ID = #{ALRAM_ID}  
     AND B.BOARD_NUM = tb_alram.alram_contnum
     order by REGDATE DESC
      </select>

<select id="alramFollowLoad" resultType="java.util.HashMap" parameterType="java.util.HashMap">
	SELECT
	*
	FROM 
	TB_ALRAM A, TB_USER U
	WHERE
	 A.ALRAM_ID = 'user1' 
     AND READDATE is null 
     AND U.ID = 'user1'  
     AND ALRAM_CONTNUM = 0
     
     order by REGDATE DESC
      </select>

<select id="selectAlramOne" resultType="hashmap" parameterType="hashmap">
SELECT 
	ALRAM_NUM,
	ALRAM_INDEX_NO,
	ALRAM_ID,
	ALRAM_CONTNUM,
	REG_ID,
	REGDATE,
	READDATE
FROM 
	TB_ALRAM
WHERE 
	ALRAM_NUM = #{ALRAM_NUM} 
</select>

<insert id="regAlram" parameterType="hashmap">
INSERT INTO TB_ALRAM(
	ALRAM_NUM, 
	ALRAM_INDEX_NO, 
	ALRAM_CONTNUM, 
	ALRAM_ID, 
	REG_ID, 
	REGDATE
	)
VALUES(
	SEQ_TB_ALARM_ALARM_NUM.nextval, 
	#{ALRAM_INDEX_NO}, 
	#{ALRAM_CONTNUM}, 
	#{ALRAM_ID}, 
	#{REG_ID}, 
	SYSDATE
	) 
</insert>

<!-- <update id="updateRegIdAlram" parameterType="hashmap">
UPDATE 
	TB_ALRAM 
SET 
	REGDATE = SYSDATE
WHERE 
	ALRAM_NUM = #{ALRAM_NUM} </update> -->

<update id="readAlram" parameterType="hashmap">
UPDATE 
	TB_ALRAM 
SET 
	READDATE = SYSDATE 
WHERE 
	ALRAM_NUM = #{ALRAM_NUM} </update> 

</mapper>