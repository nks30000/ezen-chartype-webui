<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="like">

	<select id="selectBoardLike" parameterType="java.util.HashMap"
		resultType="java.util.HashMap">
		<![CDATA[
		SELECT
		    U.PROF_IMG as PROF_IMG,
		    U.NICK as NICK,
		    L.LIKE_NUM as  LIKE_NUM,
		    L.ID as ID,
		    L.CONTENTS_NUM as CONTENTS_NUM,
		    L.DIV_NUM as DIV_NUM
		FROM
		    TB_USER U, TB_LIKE L
		WHERE
		    U.ID = L.ID AND L.CONTENTS_NUM = #{BOARD_NUM} AND U.ID IN 
		    	(SELECT			
					ID			
				FROM
					TB_LIKE
				WHERE
					DIV_NUM = 0 AND CONTENTS_NUM = #{BOARD_NUM}
				)
		]]>
	</select>

	<select id="selectTimelineLikeCheck" parameterType="java.util.HashMap"
		resultType="java.lang.Integer">
		<![CDATA[
		SELECT
			COUNT(*)
		FROM
			TB_LIKE
		WHERE
			DIV_NUM = 0 AND ID = #{USER_ID} AND CONTENTS_NUM = ${BOARD_NUM}
		]]>
	</select>

	<insert id="insertTimelineLike" parameterType="java.util.HashMap">
		<![CDATA[
		INSERT INTO TB_LIKE
			(LIKE_NUM,
			ID,
			CONTENTS_NUM,
			DIV_NUM)
		VALUES
			(SEQ_TB_LIKE_LIKE_NUM.NEXTVAL,
			#{USER_ID},
			#{BOARD_NUM},
			0)
		]]>
	</insert>
	
	<delete id="deleteTimelineLike" parameterType="java.util.HashMap">
		<![CDATA[
		DELETE FROM
			TB_LIKE
		WHERE
			DIV_NUM = 0 AND ID = #{USER_ID} AND CONTENTS_NUM = ${BOARD_NUM}
		]]>
	</delete>	

</mapper>